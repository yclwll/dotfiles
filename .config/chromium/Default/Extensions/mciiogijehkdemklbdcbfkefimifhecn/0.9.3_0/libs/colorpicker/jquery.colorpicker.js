(function(a){var e,h,n=0,q=a('<div class="colorPicker-picker">&nbsp;</div>'),r=a('<div id="colorPicker_palette" class="colorPicker-palette" />'),s=a('<div class="colorPicker-swatch">&nbsp;</div>'),t=a('<label for="colorPicker_hex">Hex</label>'),u=a('<input type="text" id="colorPicker_hex" />'),f;a.fn.colorPicker=function(b){return this.each(function(){var c=a(this),d=a.extend({},a.fn.colorPicker.defaults,b),e=a.fn.colorPicker.toHex(0<c.val().length?c.val():d.pickerDefault),k=q.clone(),l=r.clone().attr("id",
"colorPicker_palette-"+n),p=t.clone(),g=u.clone(),f=l[0].id,m,h;a.each(d.colors,function(b){m=s.clone();"transparent"===d.colors[b]?(m.addClass("transparent").text("X"),a.fn.colorPicker.bindPalette(g,m,"transparent")):(m.css("background-color","#"+this),a.fn.colorPicker.bindPalette(g,m));m.appendTo(l)});p.attr("for","colorPicker_hex-"+n);g.attr({id:"colorPicker_hex-"+n,value:e});g.bind("keydown",function(b){if(13===b.keyCode){var d=a.fn.colorPicker.toHex(a(this).val());a.fn.colorPicker.changeColor(d?
d:c.val())}27===b.keyCode&&a.fn.colorPicker.hidePalette()});g.bind("keyup",function(b){b=a.fn.colorPicker.toHex(a(b.target).val());a.fn.colorPicker.previewColor(b?b:c.val())});a('<div class="colorPicker_hexWrap" />').append(p).appendTo(l);l.find(".colorPicker_hexWrap").append(g);!1===d.showHexField&&(g.hide(),p.hide());a(this).after(l);l.hide();k.css("background-color",e);k.bind("click",function(){c.is(":not(:disabled)")&&a.fn.colorPicker.togglePalette(a("#"+f),a(this))});b&&b.onColorChange?k.data("onColorChange",
b.onColorChange):k.data("onColorChange",function(){});(h=c.data("text"))&&k.html(h);c.after(k);c.bind("change",function(){c.next(".colorPicker-picker").css("background-color",a.fn.colorPicker.toHex(a(this).val()))});c.val(e);if("input"===c[0].tagName.toLowerCase())try{c.attr("type","hidden")}catch(v){c.css("visibility","hidden").css("position","absolute")}else c.hide();n++})};a.extend(!0,a.fn.colorPicker,{toHex:function(a){if(a.match(/[0-9A-F]{6}|[0-9A-F]{3}$/i))return"#"===a.charAt(0)?a:"#"+a;if(a.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/)){var c=
[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],d=function(a){if(2>a.length)for(var b=0,c=2-a.length;b<c;b++)a="0"+a;return a};if(3===c.length){a=d(c[0].toString(16));var e=d(c[1].toString(16)),c=d(c[2].toString(16));return"#"+a+e+c}}else return!1},checkMouse:function(b,c){var d=h,f=a(b.target).parents("#"+d.attr("id")).length;b.target===a(d)[0]||b.target===e[0]||0<f||a.fn.colorPicker.hidePalette()},hidePalette:function(){a(document).unbind("mousedown",a.fn.colorPicker.checkMouse);
a(window).unbind("resize",a.fn.colorPicker.hidePalette);a(".colorPicker-palette").hide()},showPalette:function(b){var c=e.prev("input").val();b.css({top:e.offset().top+e.outerHeight(),left:e.offset().left});a("#color_value").val(c);b.show();a(document).bind("mousedown",a.fn.colorPicker.checkMouse);a(window).bind("resize",a.fn.colorPicker.hidePalette)},togglePalette:function(b,c){c&&(e=c);h=b;h.is(":visible")?a.fn.colorPicker.hidePalette():a.fn.colorPicker.showPalette(b)},changeColor:function(b){e.css("background-color",
b);e.prev("input").val(b).change();a.fn.colorPicker.hidePalette();e.data("onColorChange").call(e,a(e).prev("input").attr("id"),b)},previewColor:function(a){e.css("background-color",a)},bindPalette:function(b,c,d){d=d?d:a.fn.colorPicker.toHex(c.css("background-color"));c.bind({click:function(b){f=d;a.fn.colorPicker.changeColor(d)},mouseover:function(c){f=b.val();a(this).css("border-color","#598FEF");b.val(d);a.fn.colorPicker.previewColor(d)},mouseout:function(c){a(this).css("border-color","#000");
b.val(e.css("background-color"));b.val(f);a.fn.colorPicker.previewColor(f)}})}});a.fn.colorPicker.defaults={pickerDefault:"FFFFFF",colors:"000000 993300 333300 000080 333399 333333 800000 FF6600 808000 008000 008080 0000FF 666699 808080 FF0000 FF9900 99CC00 339966 33CCCC 3366FF 800080 999999 FF00FF FFCC00 FFFF00 00FF00 00FFFF 00CCFF 993366 C0C0C0 FF99CC FFCC99 FFFF99 CCFFFF 99CCFF FFFFFF".split(" "),addColors:[],showHexField:!0}})(jQuery);
