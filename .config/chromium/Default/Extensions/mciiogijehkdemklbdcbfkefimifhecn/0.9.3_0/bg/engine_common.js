var dy_engine={overallSpeed:0,pollProgress:function(){cur_t=Date.now()/1E3;var f=1==dy_engine.pollProgress._cnt_%10;1E4<=dy_engine.pollProgress._cnt_++&&(dy_engine.pollProgress._cnt_=0);dy_engine.poll(function(d,b,c){dy_engine.overallSpeed=d;d=[];for(b=0;b<c.length;++b){var a=c[b];d.push(a.id);a._start_time||(a._start_time=cur_t);a.time_elapsed+=cur_t-a._start_time;a._start_time=cur_t;0<a.size&&(a.progress=a.finished_bytes/a.size*100,a.progress=Math.min(100,a.progress),isFinite(a.progress)||console.log("f: "+
a.finished_bytes+" sz: "+a.size))}sendUIMessage({cmd:"u_prog",ids:d});if(dy_settings.get("notify_progress"))if(dy_bkg.popup_dlist_open||dy_bkg.ui_tab_ontop)for(b=0;b<c.length;++b)c[b]._pnotify_created=!0;else for(b=0;b<c.length;++b)dy_notify.task_progress(c[b]);if(f)for(b=0;b<c.length;++b)dy_bkg.dirtyTaskMan.set(c[b].id)})}};dy_engine.pollProgress._cnt_=1;dy_taskstarter={};
(function(){function f(){for(var a=0,b=dy_bkg.bg_tasks.length;a<b;++a){var c=dy_bkg.bg_tasks[a];if(c&&!1==c.recycled&&c.state==DyEnums.TaskState.QUEUE&&!c._limit_server)return c}return null}var d=!1,b={},c={};dy_taskstarter.queueSize=function(){return Object.keys(b).length};dy_taskstarter.enqueue=function(a){b[a.id]=!0};dy_taskstarter.dequeue=function(a){delete b[a.id]};dy_taskstarter.reschedule=function(){for(var a in c)delete c[a]._limit_server;c={};dy_taskstarter.schedule()};dy_taskstarter.schedule=
function(){if(!d){dy_bkg.showBadge(!1);var a=f();a&&(d=!0,dy_engine.idle(a,function(e){dy_bkg.showBadge(e!=DyEnums.IdleState.IDLE);if(e==DyEnums.IdleState.LIMIT_TASKS)d=!1;else{if(e==DyEnums.IdleState.IDLE){delete b[a.id];if(!dy_engine.download(a)){d=!1;return}a._limit_server&&(delete a._limit_server,delete c[a.id])}else e==DyEnums.IdleState.LIMIT_SERVER&&(a._limit_server=!0,c[a.id]=a);d=!1;setTimeout(dy_taskstarter.schedule,0)}}))}}})();
