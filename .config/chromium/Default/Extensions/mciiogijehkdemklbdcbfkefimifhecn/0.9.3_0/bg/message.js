function ext_listener(a,b,c){switch(a.cmd){case "open_ui":dy_tabman.open_ui();break;case "open_options":case "open_set":dy_tabman.open_options({})}}
function bg_listener(a,b,c){function l(a,c){a.url=a.url.replace(/ /g,"%20");if(!validateURL(a.url))return console.log("bad url in new_task()"),console.log(a.url),null;!1==/^(https?|ftp|data):/i.test(a.url)&&(a.url="http://"+a.url);var b=dy_bkg.create_task(a.url,a.referer);if(!b)return-1;b.naming=a.naming;b.text=a.text||"";b.title=a.title||"";b.desc=a.desc;b.page_title=c;b.max_threads_config=5;b.naming&&dy_namingman.touch(b.naming);return b}switch(a.cmd){case "open_options":dy_tabman.open_options({section:a.section});
break;case "blog":console.log(a.data);break;case "browse":return!0;case "path_list":a={};a.list=dy_pathman.get_recents();c(a);break;case "naming_list":a={};a.list=dy_namingman.get_recents();c(a);break;case "dlg_options":c({fontSize:dy_settings.get("font_size"),taskDef:dy_settings.get_taskdef()});break;case "new_task":if(a.tasks){var g=b=!1,h=a.add_paused,f=a.addtop,m=a.page_title,e=dy_bkg.bg_tasks.length+10,n=a.notify&&dy_settings.get("notify_oneclick");c=0;for(var p=a.tasks.length;c<p;++c){var d=
l(a.tasks[c],m);if(-1==d){b=!0;break}else if(null!=d){h||(d.state=DyEnums.TaskState.QUEUE,dy_taskstarter.enqueue(d),g=!0);var k=dy_bkg.push_task(d,f);k<e&&(e=k);n&&(dy_notify.task_start(d,h),dy_notify.show_tip("tip_notifications",6))}}e<dy_bkg.bg_tasks.length&&(chrome.runtime.sendMessage({cmd:"u_new",idx:e,addtop:f,scroll_id:dy_bkg.bg_tasks[f?0:dy_bkg.bg_tasks.length-1].id}),dy_bkg.animateFlip(),g&&dy_taskstarter.schedule());b&&dy_tabman.open_ui({activate:!0},function(){chrome.runtime.sendMessage({cmd:"u_alert",
data:DyStrings.Error.noID})})}break;case "url_desc":dy_urlmonitor.setURLDesc(a.url,a.download,a.text,a.title,a.page_title||(b.tab?b.tab.title:""));break;case "poll_progress":dy_engine.pollProgress();break;case "import":if("chrome"==a.src)return dy_bkg.importChrome(c),!0;break;case "u_fields":if(-1!=dy_bkg.ui_tabid)break;if(b=dy_bkg.task_by_id(a.id))b._cf={};break;case "u_prog":case "u_tasks":case "u_tasks_by_field":if(-1!=dy_bkg.ui_tabid)break;for(c=0;c<a.ids.length;++c)if(b=dy_bkg.task_by_id(a.ids[c]))b._cf=
{}}};
