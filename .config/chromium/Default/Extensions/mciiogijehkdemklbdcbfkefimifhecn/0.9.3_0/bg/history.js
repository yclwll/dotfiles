function HistoryMan(n,p,q,r){function h(){if(g){var c=b.length;localStorage[l]=c;for(var a=0;a<c;++a)localStorage[f+a]=JSON.stringify(b[a]);for(a=c;a<k;++a)localStorage.removeItem(f+a);g=!1}}function s(b,a){return a.cnt==b.cnt?a.time-b.time:a.cnt-b.cnt}function m(c){for(var a=0,e=b.length,d=(new Date).getTime(),f=1;a<e;++a)if(b[a].value==c){if(4E3>d-b[a].time)return;f=b[a].cnt+1;b[a].cnt=1E6;b[a].time=d;break}a>=e&&(e>=k&&b.splice(k-1,1),b.push({value:c,cnt:1E6,time:d}));b.sort(s);b[0].cnt=f;g=!0;
h()}var b=[],k=q||15,t=r||6,g=!1,f=n,l=p;return{load:function(c){var a=parseInt(localStorage[l]);isNaN(a)&&(a=0);for(var e="",d=0;d<a;++d)(e=localStorage[f+d])&&b.push(JSON.parse(e));g=b.length!=a;h();if(0==a)for(d=0;d<c.length;++d)m(c[d])},commit:h,touch:m,get_recents:function(){for(var c=Math.min(t,b.length),a=[],e=0;e<c;++e)a.push(b[e].value);return a},get_last:function(){return 0<b.length?b[0].value:null}}};
