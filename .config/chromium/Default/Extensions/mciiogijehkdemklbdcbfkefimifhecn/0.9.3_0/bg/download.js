function get_first_item_in_queue(){for(var a=0,b=dy_bkg.bg_tasks.length;a<b;++a){var c=dy_bkg.bg_tasks[a];if(c&&!1==c.recycled&&c.state==DyEnums.TaskState.QUEUE)return c}return null}function schedule(){dy_obj.idle(function(a){a&&(a=get_first_item_in_queue(),console.log("yeah, ready to download "+(a?a.id:"")),a&&download(a)&&(chrome.extension.sendMessage({cmd:"u_task",id:a.id,data:a}),setTimeout(schedule,0)))})}
function add_start_task(a){a.state==DyEnums.TaskState.DOWNLOAD&&(a._start_time=Date.now()/1E3)}
function download(a){if(!a)return!1;if(a.restarting||-1==a.size)return a.state=dy_obj.newt(a.id,a.url,a.referer,a.folder,a.max_threads_config)?DyEnums.TaskState.DOWNLOAD:DyEnums.TaskState.ERROR,delete a.restarting,add_start_task(a),!0;if(a.bits)return a.state=dy_obj.resume(a)?DyEnums.TaskState.DOWNLOAD:DyEnums.TaskState.ERROR,add_start_task(a),!0;dy_store.getBits(a.id,function(b){a.bits=b;a.state=b?dy_obj.resume(a)?DyEnums.TaskState.DOWNLOAD:DyEnums.TaskState.ERROR:dy_obj.newt(a.id,a.url,a.referer,
a.folder,a.max_threads_config)?DyEnums.TaskState.DOWNLOAD:DyEnums.TaskState.ERROR;add_start_task(a);schedule()});return!1};
